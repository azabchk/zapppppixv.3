# Toy Exchange - Биржевая торговая платформа

Полнофункциональная биржевая система на FastAPI с PostgreSQL и Docker.

## Возможности

### Публичное API
- **Регистрация пользователей** - создание аккаунта и получение токена
- **Список инструментов** - просмотр доступных для торговли активов
- **Стакан заявок** - текущие bid/ask уровни
- **История сделок** - последние транзакции по инструменту

### Пользовательское API
- **Управление балансами** - просмотр собственных средств
- **Торговые заявки**:
  - Лимитные заявки (по указанной цене)
  - Рыночные заявки (по текущей рыночной цене)
  - Отмена активных заявок
  - Просмотр статуса и истории заявок

### Административное API
- **Управление пользователями** - удаление аккаунтов
- **Управление инструментами** - добавление/удаление торговых пар
- **Управление балансами** - пополнение/списание средств пользователей

## Технологический стек

- **FastAPI** - веб-фреймворк
- **PostgreSQL** - база данных
- **SQLAlchemy** - ORM
- **Docker** - контейнеризация
- **Pydantic** - валидация данных

## Быстрый старт

### 1. Клонирование и запуск

```bash
# Запуск с Docker Compose
docker-compose up --build

# Или локально (требует PostgreSQL)
pip install -r requirements.txt
uvicorn main:app --reload
```

### 2. Документация API

После запуска доступна по адресу:
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

### 3. Базовые примеры

#### Регистрация пользователя
```bash
curl -X POST "http://localhost:8000/api/v1/public/register" \
  -H "Content-Type: application/json" \
  -d '{"name": "Трейдер"}'
```

#### Авторизация
Используйте полученный `api_key` в заголовке:
```
Authorization: TOKEN your-api-key-here
```

#### Создание инструмента (админ)
```bash
curl -X POST "http://localhost:8000/api/v1/admin/instrument" \
  -H "Authorization: TOKEN admin-token-12345" \
  -H "Content-Type: application/json" \
  -d '{"name": "Bitcoin", "ticker": "BTC"}'
```

#### Создание лимитной заявки
```bash
curl -X POST "http://localhost:8000/api/v1/order" \
  -H "Authorization: TOKEN your-api-key" \
  -H "Content-Type: application/json" \
  -d '{
    "direction": "BUY",
    "ticker": "BTC", 
    "qty": 10,
    "price": 50000
  }'
```

## Архитектура

### Модель данных
- **Users** - пользователи системы
- **Instruments** - торговые инструменты
- **Balances** - балансы пользователей по инструментам
- **Orders** - заявки на покупку/продажу
- **Transactions** - исполненные сделки

### Торговый движок
- Автоматическое исполнение рыночных заявок
- Матчинг лимитных заявок по price-time priority
- Обновление балансов в реальном времени
- Поддержка частичного исполнения

### Безопасность
- Токен-based аутентификация
- Разделение ролей (USER/ADMIN)
- Валидация входных данных

## Конфигурация

### Переменные окружения
- `DATABASE_URL` - строка подключения к PostgreSQL
- По умолчанию: `postgresql://postgres:password@localhost:5432/toy_exchange`

### Администратор по умолчанию
- Токен: `admin-token-12345`
- Создается автоматически при запуске

## API Reference

Полная документация API соответствует OpenAPI 3.1.0 спецификации и доступна в Swagger UI.
